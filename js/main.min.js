"use strict";function createSpriteShape(){var e=document.createElement("canvas");e.width=128,e.height=128;var t=e.getContext("2d"),r=document.getElementById("label-img");t.drawImage(r,0,0);var n=new THREE.Texture(e);n.needsUpdate=!0;var a=new THREE.SpriteMaterial({map:n}),o=new THREE.Sprite(a);return o.scale.set(100,100,1),o}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){if(requestAnimationFrame(animate),mixers.length>0)for(var e=0;e<mixers.length;e++)mixers[e].update(clock.getDelta());render()}function render(){renderer.render(scene,camera)}function change(e){"Car_truck13"==e.name||e.name,"Door_BL09"!==e.name&&"Car_truck08"!=e.name||(e.material.color=(new THREE.Color).setHex(1381653)),"logo"==e.name&&(e.material.color=(new THREE.Color).setHex(4521993)),/Plane001/.test(e.name)&&(e.material.transparent=!0,e.material.color=(new THREE.Color).setHex(0)),/Car_Body|Car_truck|Car_plastic/.test(e.name)&&(e.material.envMap=textureCube,e.material.combine=THREE.MultiplyOperation,e.material.shininess=1.8,e.material.reflectivity=.5),/chrome|Door_BR06/.test(e.name)&&(e.material.color=(new THREE.Color).setHex(4013373),e.material.envMap=textureCube,e.material.specular=(new THREE.Color).setHex(16777215),e.material.combine=THREE.MultiplyOperation,e.material.reflectivity=.8,e.material.shininess=2),"Wheel_BR01"==e.name&&(e.material.specular=(new THREE.Color).setHex(1118481)),"Wheel_BR03"==e.name&&(e.material.envMap=textureCube,e.material.specular=(new THREE.Color).setHex(4013635),e.material.combine=THREE.MultiplyOperation,e.material.reflectivity=.5,e.material.shininess=58),/Car_Glass/.test(e.name)&&(e.material.color=(new THREE.Color).setHex(1184274),e.material.specular=new THREE.Color("rgb(255, 255, 255)"),e.material.envMap=textureCube,e.material.reflectivity=.5,e.material.shininess=1),(/Car_Body/.test(e.name)||"Car_truck07"==e.name)&&(e.material.color=(new THREE.Color).setHex(7667725)),/Car_plastic|Wheel/.test(e.name),"Car_plastic"!=e.name&&"Car_Int04d"!=e.name&&"Car_truck09"!=e.name&&"Door_FL12"!=e.name&&"Door_BL04"!=e.name||(e.material.color=new THREE.Color("rgb(20, 24, 35)"),e.material.specular=(new THREE.Color).setHex(2039593),e.material.combine=THREE.MixOperation,e.material.reflectivity=.1,e.material.shininess=5),"Wheel_Other08"==e.name&&(e.material.color=new THREE.Color("rgb(148, 1, 19)"),e.material.envMap=textureCube,e.material.specular=(new THREE.Color).setHex(16777215),e.material.combine=THREE.MultiplyOperation,e.material.reflectivity=.5,e.material.shininess=1),"Wheel_Other01"!=e.name&&"Wheel_BR02"!=e.name&&"Wheel_Other02"!=e.name&&"Wheel_Other00"!=e.name||(e.material.color=new THREE.Color("rgb(113, 99, 96)"),e.material.envMap=textureCube,e.material.specular=(new THREE.Color).setHex(16777215),e.material.combine=THREE.MultiplyOperation,e.material.reflectivity=.5,e.material.shininess=3),"Wheel_FL01"!=e.name&&"Wheel_BL04"!=e.name&&"Wheel_BR01"!=e.name&&"Wheel_FR00"!=e.name&&"Wheel_BL01"!=e.name||(e.material.metalness=.82,e.material.envMap=textureCube,e.material.color=new THREE.Color("rgb(20, 24, 35)"),e.material.specular=(new THREE.Color).setHex(2039593),e.material.combine=THREE.MultiplyOperation,e.material.reflectivity=.1,e.material.shininess=5),"Car_chrome"!=e.name&&"Car_truck01"!=e.name||(e.material.color=(new THREE.Color).setHex(16777215)),"Car_chrome"==e.name&&(e.material.specular=(new THREE.Color).setHex(16777215),e.material.shininess=65),/Car_Glass_Light1/.test(e.name)&&(e.material.color=(new THREE.Color).lerp({r:255,g:255,b:255},.8),e.material.opacity=.2),/car_chrome02/.test(e.name)&&(e.material.color=new THREE.Color("rgb(18, 121, 187)")),/car_seat/.test(e.name)&&(e.material.color=(new THREE.Color).setHex(3158064),e.material.specular=(new THREE.Color).setHex(6768967),e.material.reflectivity=.1,e.material.shininess=4),"Car_Int03"==e.name&&(e.material.color=(new THREE.Color).setHex(8026746),e.material.specular=(new THREE.Color).setHex(0),e.material.shininess=1),"Car_Int05"==e.name&&(e.material.color=(new THREE.Color).setHex(1118481)),"Car_Int06"==e.name&&(e.material.color=(new THREE.Color).setHex(8026746))}function init(){function e(e){n.traverse(function(t){t instanceof THREE.Sprite&&e.name!==t.name&&(t.status="close")})}function t(t){mouse.x=t.clientX/window.innerWidth*2-1,mouse.y=-t.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera),n.traverse(function(t){if(t instanceof THREE.Sprite)for(var r=raycaster.intersectObjects(t.parent.children),n=0;n<r.length;n++){timer&&clearTimeout(timer);var a=r[n].object,o=a.status;"close"===o?(action.time=a.open,action.paused=!1,action.play(),a.status="open",e(a),timer=setTimeout(function(){action.paused=!0,"fl"!=a.name&&"fr"!=a.name||openDoor()},a.openDur)):(action.time=a.close,action.paused=!1,action.play(),a.status="close",timer=setTimeout(function(){action.paused=!0},a.closeDur))}})}container=document.getElementById("canvasContainer"),document.body.appendChild(container),camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),scene=new THREE.Scene;var r=new THREE.LoadingManager;r.onProgress=function(e,t,r){};var n,a=(document.getElementById("loading"),function(e){onLoadProgress(e)}),o=function(e){console.error(e)},i=[{name:"fl",label:"Door_FL03",position:{x:0,y:110,z:100},open:0,openDur:2.4,close:2.4,closeDur:2.5},{name:"bl",label:"Door_BL00",position:{x:106,y:115,z:100},open:10,openDur:2.5,close:12.5,closeDur:2.5},{name:"fr",label:"Door_FR11",position:{x:79,y:25,z:-10},open:5.5,openDur:2,close:7.5,closeDur:2.5},{name:"br",label:"Door_BR02",position:{x:109,y:121,z:-100},open:15.5,openDur:2,close:17.5,closeDur:2.5},{name:"truck",label:"Car_truck07",position:{x:250,y:230,z:-3},open:20,openDur:2.3,close:22.3,closeDur:4}];new THREE.FBXLoader(r).load("R9v43.fbx",function(e){console.info("parseOK!"),n=e,e.scale.multiplyScalar(1),e.mixer=new THREE.AnimationMixer(e),mixers.push(e.mixer),action=e.mixer.clipAction(e.animations[0]),e.scale.set(.0034,.0034,.0034),e.position.set(0,-.25,0),scene.add(e);var t="img/hj/",r=[t+"posx.jpg",t+"negx.jpg",t+"posy.jpg",t+"negy.jpg",t+"posz.jpg",t+"negz.jpg"];textureCube=(new THREE.CubeTextureLoader).load(r),e.traverse(function(e){e instanceof THREE.Mesh&&(change(e),i.forEach(function(t,r){if(new RegExp(t.label).test(e.name)){var n=createSpriteShape();n.name=t.name,n.open=t.open,n.openDur=1e3*t.openDur,n.close=t.close,n.closeDur=1e3*t.closeDur,n.status="close",n.scale.set(40,40,40),n.position.copy(t.position),e.add(n)}}))})},a,o),renderer=new THREE.WebGLRenderer,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),controls=new THREE.OrbitControls(camera,renderer.domElement),controls.minPolarAngle=-Math.PI/1.9,controls.maxPolarAngle=Math.PI/1.9,controls.target.set(0,0,0),controls.addEventListener("change",function(e){}),controls.enableZoom=!1,camera.position.set(-1.7077679027035708,-.043401824895598545,.9930627089978632),controls.update(),window.addEventListener("resize",onWindowResize,!1),light=new THREE.HemisphereLight(16777215,16777215,1),light.position.set(0,1,0),scene.add(light);var s=(new THREE.AmbientLight(328965),new THREE.PointLight(16777215,1));s.position.set(2e3,1200,1e4),scene.add(s);var l=new THREE.PointLight(16777215,1);l.position.set(2e3,1200,-1e4),scene.add(l);var c=new THREE.DirectionalLight(16777215,1);c.position.set(0,10,0).normalize(),c.rotation.z=Math.PI/180*90,scene.add(c),window.addEventListener("mousedown",t,!1),animate()}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window.addEventListener("orientationchange",function(e){shanGong.remInit(1750,75),setTimeout(function(){onWindowResize()},500)}),THREE.OrbitControls=function(e,t){function r(){return 2*Math.PI/60/60*O.autoRotateSpeed}function n(){return Math.pow(.95,O.zoomSpeed)}function a(e){U.theta-=e}function o(e){U.phi-=e}function i(e){O.object.isPerspectiveCamera?z/=e:O.object.isOrthographicCamera?(O.object.zoom=Math.max(O.minZoom,Math.min(O.maxZoom,O.object.zoom*e)),O.object.updateProjectionMatrix(),X=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),O.enableZoom=!1)}function s(e){O.object.isPerspectiveCamera?z*=e:O.object.isOrthographicCamera?(O.object.zoom=Math.max(O.minZoom,Math.min(O.maxZoom,O.object.zoom/e)),O.object.updateProjectionMatrix(),X=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),O.enableZoom=!1)}function l(e){W.set(e.clientX,e.clientY)}function c(e){q.set(e.clientX,e.clientY)}function u(e){Y.set(e.clientX,e.clientY)}function p(e){G.set(e.clientX,e.clientY),Z.subVectors(G,W);var t=O.domElement===document?O.domElement.body:O.domElement;a(2*Math.PI*Z.x/t.clientWidth*O.rotateSpeed),o(2*Math.PI*Z.y/t.clientHeight*O.rotateSpeed),W.copy(G),O.update()}function d(e){$.set(e.clientX,e.clientY),J.subVectors($,q),J.y>0?i(n()):J.y<0&&s(n()),q.copy($),O.update()}function h(e){K.set(e.clientX,e.clientY),Q.subVectors(K,Y),re(Q.x,Q.y),Y.copy(K),O.update()}function f(e){}function m(e){e.deltaY<0?s(n()):e.deltaY>0&&i(n()),O.update()}function v(e){switch(e.keyCode){case O.keys.UP:re(0,O.keyPanSpeed),O.update();break;case O.keys.BOTTOM:re(0,-O.keyPanSpeed),O.update();break;case O.keys.LEFT:re(O.keyPanSpeed,0),O.update();break;case O.keys.RIGHT:re(-O.keyPanSpeed,0),O.update()}}function g(e){W.set(e.touches[0].pageX,e.touches[0].pageY)}function E(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);q.set(0,n)}function b(e){Y.set(e.touches[0].pageX,e.touches[0].pageY)}function y(e){G.set(e.touches[0].pageX,e.touches[0].pageY),Z.subVectors(G,W);var t=O.domElement===document?O.domElement.body:O.domElement;a(2*Math.PI*Z.x/t.clientWidth*O.rotateSpeed),o(2*Math.PI*Z.y/t.clientHeight*O.rotateSpeed),W.copy(G),O.update()}function w(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+r*r);$.set(0,a),J.subVectors($,q),J.y>0?s(n()):J.y<0&&i(n()),q.copy($),O.update()}function T(e){K.set(e.touches[0].pageX,e.touches[0].pageY),Q.subVectors(K,Y),re(Q.x,Q.y),Y.copy(K),O.update()}function R(e){}function H(e){if(!1!==O.enabled){switch(e.preventDefault(),e.button){case O.mouseButtons.ORBIT:if(!1===O.enableRotate)return;l(e),B=k.ROTATE;break;case O.mouseButtons.ZOOM:if(!1===O.enableZoom)return;c(e),B=k.DOLLY;break;case O.mouseButtons.PAN:if(!1===O.enablePan)return;u(e),B=k.PAN}B!==k.NONE&&(document.addEventListener("mousemove",C,!1),document.addEventListener("mouseup",x,!1),O.dispatchEvent(M))}}function C(e){if(!1!==O.enabled)switch(e.preventDefault(),B){case k.ROTATE:if(!1===O.enableRotate)return;p(e);break;case k.DOLLY:if(!1===O.enableZoom)return;d(e);break;case k.PAN:if(!1===O.enablePan)return;h(e)}}function x(e){!1!==O.enabled&&(f(e),document.removeEventListener("mousemove",C,!1),document.removeEventListener("mouseup",x,!1),O.dispatchEvent(P),B=k.NONE)}function I(e){!1===O.enabled||!1===O.enableZoom||B!==k.NONE&&B!==k.ROTATE||(e.preventDefault(),e.stopPropagation(),m(e),O.dispatchEvent(M),O.dispatchEvent(P))}function N(e){!1!==O.enabled&&!1!==O.enableKeys&&!1!==O.enablePan&&v(e)}function S(e){if(!1!==O.enabled){switch(e.touches.length){case 1:if(!1===O.enableRotate)return;g(e),B=k.TOUCH_ROTATE;break;case 2:if(!1===O.enableZoom)return;E(e),B=k.TOUCH_DOLLY;break;case 3:if(!1===O.enablePan)return;b(e),B=k.TOUCH_PAN;break;default:B=k.NONE}B!==k.NONE&&O.dispatchEvent(M)}}function L(e){if(!1!==O.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===O.enableRotate)return;if(B!==k.TOUCH_ROTATE)return;y(e);break;case 2:if(!1===O.enableZoom)return;if(B!==k.TOUCH_DOLLY)return;w(e);break;case 3:if(!1===O.enablePan)return;if(B!==k.TOUCH_PAN)return;T(e);break;default:B=k.NONE}}function D(e){!1!==O.enabled&&(R(e),O.dispatchEvent(P),B=k.NONE)}function A(e){!1!==O.enabled&&e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return _.phi},this.getAzimuthalAngle=function(){return _.theta},this.saveState=function(){O.target0.copy(O.target),O.position0.copy(O.object.position),O.zoom0=O.object.zoom},this.reset=function(){O.target.copy(O.target0),O.object.position.copy(O.position0),O.object.zoom=O.zoom0,O.object.updateProjectionMatrix(),O.dispatchEvent(F),O.update(),B=k.NONE},this.update=function(){var t=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),o=n.clone().inverse(),i=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=O.object.position;return t.copy(e).sub(O.target),t.applyQuaternion(n),_.setFromVector3(t),O.autoRotate&&B===k.NONE&&a(r()),_.theta+=U.theta,_.phi+=U.phi,_.theta=Math.max(O.minAzimuthAngle,Math.min(O.maxAzimuthAngle,_.theta)),_.phi=Math.max(O.minPolarAngle,Math.min(O.maxPolarAngle,_.phi)),_.makeSafe(),_.radius*=z,_.radius=Math.max(O.minDistance,Math.min(O.maxDistance,_.radius)),O.target.add(V),t.setFromSpherical(_),t.applyQuaternion(o),e.copy(O.target).add(t),O.object.lookAt(O.target),!0===O.enableDamping?(U.theta*=1-O.dampingFactor,U.phi*=1-O.dampingFactor):U.set(0,0,0),z=1,V.set(0,0,0),!!(X||i.distanceToSquared(O.object.position)>j||8*(1-s.dot(O.object.quaternion))>j)&&(O.dispatchEvent(F),i.copy(O.object.position),s.copy(O.object.quaternion),X=!1,!0)}}(),this.dispose=function(){O.domElement.removeEventListener("contextmenu",A,!1),O.domElement.removeEventListener("mousedown",H,!1),O.domElement.removeEventListener("wheel",I,!1),O.domElement.removeEventListener("touchstart",S,!1),O.domElement.removeEventListener("touchend",D,!1),O.domElement.removeEventListener("touchmove",L,!1),document.removeEventListener("mousemove",C,!1),document.removeEventListener("mouseup",x,!1),window.removeEventListener("keydown",N,!1)};var O=this,F={type:"change"},M={type:"start"},P={type:"end"},k={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},B=k.NONE,j=1e-6,_=new THREE.Spherical,U=new THREE.Spherical,z=1,V=new THREE.Vector3,X=!1,W=new THREE.Vector2,G=new THREE.Vector2,Z=new THREE.Vector2,Y=new THREE.Vector2,K=new THREE.Vector2,Q=new THREE.Vector2,q=new THREE.Vector2,$=new THREE.Vector2,J=new THREE.Vector2,ee=function(){var e=new THREE.Vector3;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),V.add(e)}}(),te=function(){var e=new THREE.Vector3;return function(t,r){e.setFromMatrixColumn(r,1),e.multiplyScalar(t),V.add(e)}}(),re=function(){var e=new THREE.Vector3;return function(t,r){var n=O.domElement===document?O.domElement.body:O.domElement;if(O.object.isPerspectiveCamera){var a=O.object.position;e.copy(a).sub(O.target);var o=e.length();o*=Math.tan(O.object.fov/2*Math.PI/180),ee(2*t*o/n.clientHeight,O.object.matrix),te(2*r*o/n.clientHeight,O.object.matrix)}else O.object.isOrthographicCamera?(ee(t*(O.object.right-O.object.left)/O.object.zoom/n.clientWidth,O.object.matrix),te(r*(O.object.top-O.object.bottom)/O.object.zoom/n.clientHeight,O.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),O.enablePan=!1)}}();O.domElement.addEventListener("contextmenu",A,!1),O.domElement.addEventListener("mousedown",H,!1),O.domElement.addEventListener("wheel",I,!1),O.domElement.addEventListener("touchstart",S,!1),O.domElement.addEventListener("touchend",D,!1),O.domElement.addEventListener("touchmove",L,!1),window.addEventListener("keydown",N,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),THREE.NURBSCurve=function(e,t,r,n,a){THREE.Curve.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=a||this.knots.length-1;for(var o=0;o<r.length;++o){var i=r[o];this.controlPoints[o]=new THREE.Vector4(i.x,i.y,i.z,i.w)}},THREE.NURBSCurve.prototype=Object.create(THREE.Curve.prototype),THREE.NURBSCurve.prototype.constructor=THREE.NURBSCurve,THREE.NURBSCurve.prototype.getPoint=function(e){var t=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=THREE.NURBSUtils.calcBSplinePoint(this.degree,this.knots,this.controlPoints,t);return 1!=r.w&&r.divideScalar(r.w),new THREE.Vector3(r.x,r.y,r.z)},THREE.NURBSCurve.prototype.getTangent=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=THREE.NURBSUtils.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,t,1),n=r[1].clone();return n.normalize(),n},THREE.NURBSUtils={findSpan:function(e,t,r){var n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;for(var a=e,o=n,i=Math.floor((a+o)/2);t<r[i]||t>=r[i+1];)t<r[i]?o=i:a=i,i=Math.floor((a+o)/2);return i},calcBasisFunctions:function(e,t,r,n){var a=[],o=[],i=[];a[0]=1;for(var s=1;s<=r;++s){o[s]=t-n[e+1-s],i[s]=n[e+s]-t;for(var l=0,c=0;c<s;++c){var u=i[c+1],p=o[s-c],d=a[c]/(u+p);a[c]=l+u*d,l=p*d}a[s]=l}return a},calcBSplinePoint:function(e,t,r,n){for(var a=this.findSpan(e,n,t),o=this.calcBasisFunctions(a,n,e,t),i=new THREE.Vector4(0,0,0,0),s=0;s<=e;++s){var l=r[a-e+s],c=o[s],u=l.w*c;i.x+=l.x*u,i.y+=l.y*u,i.z+=l.z*u,i.w+=l.w*c}return i},calcBasisFunctionDerivatives:function(e,t,r,n,a){for(var o=[],i=0;i<=r;++i)o[i]=0;for(var s=[],i=0;i<=n;++i)s[i]=o.slice(0);for(var l=[],i=0;i<=r;++i)l[i]=o.slice(0);l[0][0]=1;for(var c=o.slice(0),u=o.slice(0),p=1;p<=r;++p){c[p]=t-a[e+1-p],u[p]=a[e+p]-t;for(var d=0,h=0;h<p;++h){var f=u[h+1],m=c[p-h];l[p][h]=f+m;var v=l[h][p-1]/l[p][h];l[h][p]=d+f*v,d=m*v}l[p][p]=d}for(var p=0;p<=r;++p)s[0][p]=l[p][r];for(var h=0;h<=r;++h){for(var g=0,E=1,b=[],i=0;i<=r;++i)b[i]=o.slice(0);b[0][0]=1;for(var y=1;y<=n;++y){var w=0,T=h-y,R=r-y;h>=y&&(b[E][0]=b[g][0]/l[R+1][T],w=b[E][0]*l[T][R]);for(var H=T>=-1?1:-T,C=h-1<=R?y-1:r-h,p=H;p<=C;++p)b[E][p]=(b[g][p]-b[g][p-1])/l[R+1][T+p],w+=b[E][p]*l[T+p][R];h<=R&&(b[E][y]=-b[g][y-1]/l[R+1][h],w+=b[E][y]*l[h][R]),s[y][h]=w;var p=g;g=E,E=p}}for(var h=r,y=1;y<=n;++y){for(var p=0;p<=r;++p)s[y][p]*=h;h*=r-y}return s},calcBSplineDerivatives:function(e,t,r,n,a){for(var o=a<e?a:e,i=[],s=this.findSpan(e,n,t),l=this.calcBasisFunctionDerivatives(s,n,e,o,t),c=[],u=0;u<r.length;++u){var p=r[u].clone(),d=p.w;p.x*=d,p.y*=d,p.z*=d,c[u]=p}for(var h=0;h<=o;++h){for(var p=c[s-e].clone().multiplyScalar(l[h][0]),f=1;f<=e;++f)p.add(c[s-e+f].clone().multiplyScalar(l[h][f]));i[h]=p}for(var h=o+1;h<=a+1;++h)i[h]=new THREE.Vector4(0,0,0);return i},calcKoverI:function(e,t){for(var r=1,n=2;n<=e;++n)r*=n;for(var a=1,n=2;n<=t;++n)a*=n;for(var n=2;n<=e-t;++n)a*=n;return r/a},calcRationalCurveDerivatives:function(e){for(var t=e.length,r=[],n=[],a=0;a<t;++a){var o=e[a];r[a]=new THREE.Vector3(o.x,o.y,o.z),n[a]=o.w}for(var i=[],s=0;s<t;++s){for(var l=r[s].clone(),a=1;a<=s;++a)l.sub(i[s-a].clone().multiplyScalar(this.calcKoverI(s,a)*n[a]));i[s]=l.divideScalar(n[0])}return i},calcNURBSDerivatives:function(e,t,r,n,a){var o=this.calcBSplineDerivatives(e,t,r,n,a);return this.calcRationalCurveDerivatives(o)},calcSurfacePoint:function(e,t,r,n,a,o,i){for(var s=this.findSpan(e,o,r),l=this.findSpan(t,i,n),c=this.calcBasisFunctions(s,o,e,r),u=this.calcBasisFunctions(l,i,t,n),p=[],d=0;d<=t;++d){p[d]=new THREE.Vector4(0,0,0,0);for(var h=0;h<=e;++h){var f=a[s-e+h][l-t+d].clone(),m=f.w;f.x*=m,f.y*=m,f.z*=m,p[d].add(f.multiplyScalar(c[h]))}}for(var v=new THREE.Vector4(0,0,0,0),d=0;d<=t;++d)v.add(p[d].multiplyScalar(u[d]));return v.divideScalar(v.w),new THREE.Vector3(v.x,v.y,v.z)}},function(){function e(e){var t=new Map;if("Connections"in e)for(var r=e.Connections.properties.connections,n=0,a=r.length;n<a;++n){var o=r[n];t.has(o[0])||t.set(o[0],{parents:[],children:[]});var i={ID:o[1],relationship:o[2]};t.get(o[0]).parents.push(i),t.has(o[1])||t.set(o[1],{parents:[],children:[]});var s={ID:o[0],relationship:o[2]};t.get(o[1]).children.push(s)}return t}function t(e){var t=new Map;if("Video"in e.Objects.subNodes){var n=e.Objects.subNodes.Video;for(var a in n){if("Content"in n[a].properties){var o=r(n[a]);t.set(parseInt(a),o)}}}return t}function r(e){var t,r=e.properties.Content,n=e.properties.RelativeFilename||e.properties.Filename,a=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(a){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if("string"==typeof r)return"data:"+t+";base64,"+r;var o=new Uint8Array(r);return window.URL.createObjectURL(new Blob([o],{type:t}))}function n(e,t,r,n){var o=new Map;if("Texture"in e.Objects.subNodes){var i=e.Objects.subNodes.Texture;for(var s in i){var l=a(i[s],t,r,n);o.set(parseInt(s),l)}}return o}function a(e,t,r,n){var a,o=e.id,i=e.attrName,s=e.properties.FileName,l=e.properties.RelativeFilename,c=n.get(o).children;if(void 0!==c&&c.length>0&&r.has(c[0].ID))a=r.get(c[0].ID);else if(void 0!==l&&"/"!==l[0]&&null===l.match(/^[a-zA-Z]:/))a=l;else{var u=s.split(/[\\\/]/);a=u.length>0?u[u.length-1]:s}var p=t.path;0!==a.indexOf("blob:")&&0!==a.indexOf("data:")||t.setPath(void 0);var d=t.load(a);d.name=i,d.FBX_ID=o;var h=e.properties.WrapModeU,f=e.properties.WrapModeV,m=void 0!==h?h.value:0,v=void 0!==f?f.value:0;if(d.wrapS=0===m?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,d.wrapT=0===v?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e.properties){var g=e.properties.Scaling.value;d.repeat.x=g[0],d.repeat.y=g[1]}return t.setPath(p),d}function o(e,t,r){var n=new Map;if("Material"in e.Objects.subNodes){var a=e.Objects.subNodes.Material;for(var o in a){var s=i(a[o],t,r);null!==s&&n.set(parseInt(o),s)}}return n}function i(e,t,r){var n=e.id,a=e.attrName,o=e.properties.ShadingModel;if("object"===(void 0===o?"undefined":_typeof(o))&&(o=o.value),!r.has(n))return null;var i,l=r.get(n).children,c=s(e.properties,t,l);switch(o.toLowerCase()){case"phong":i=new THREE.MeshPhongMaterial;break;case"lambert":i=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),i=new THREE.MeshPhongMaterial({color:3342591})}return i.setValues(c),i.name=a,i}function s(e,t,r){var n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse&&(n.color=z(e.Diffuse)),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Specular&&(n.specular=z(e.Specular)),e.Shininess&&(n.shininess=e.Shininess.value),e.Emissive&&(n.emissive=z(e.Emissive)),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0);for(var a=0,o=r.length;a<o;++a){var i=r[a],s=i.relationship;switch(s){case"Bump":n.bumpMap=t.get(i.ID);break;case"DiffuseColor":n.map=t.get(i.ID);break;case"DisplacementColor":n.displacementMap=t.get(i.ID);break;case"EmissiveColor":n.emissiveMap=t.get(i.ID);break;case"NormalMap":n.normalMap=t.get(i.ID);break;case"ReflectionColor":n.envMap=t.get(i.ID),n.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":n.specularMap=t.get(i.ID);break;case"TransparentColor":n.alphaMap=t.get(i.ID),n.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",s)}}return n}function l(e,t){var r={};if("Deformer"in e.Objects.subNodes){var n=e.Objects.subNodes.Deformer;for(var a in n){if("Skin"===n[a].attrType){var o=t.get(parseInt(a)),i=c(o,n);i.FBX_ID=parseInt(a),r[a]=i}}}return r}function c(e,t){for(var r={},n=e.children,a=0,o=n.length;a<o;++a){var i=n[a],s=t[i.ID],l={FBX_ID:i.ID,index:a,indices:[],weights:[],transform:(new THREE.Matrix4).fromArray(s.subNodes.Transform.properties.a),transformLink:(new THREE.Matrix4).fromArray(s.subNodes.TransformLink.properties.a),linkMode:s.properties.Mode};"Indexes"in s.subNodes&&(l.indices=s.subNodes.Indexes.properties.a,l.weights=s.subNodes.Weights.properties.a),r[i.ID]=l}return{map:r,bones:[]}}function u(e,t,r){var n=new Map;if("Geometry"in e.Objects.subNodes){var a=e.Objects.subNodes.Geometry;for(var o in a){var i=t.get(parseInt(o)),s=p(a[o],i,r);n.set(parseInt(o),s)}}return n}function p(e,t,r){switch(e.attrType){case"Mesh":return d(e,t,r);case"NurbsCurve":return b(e)}}function d(e,t,r){for(var n=0;n<t.children.length;++n){var a=r[t.children[n].ID];if(void 0!==a)break}return h(e,a)}function h(e,t){var r=e.subNodes,n=r.Vertices.properties.a,a=r.PolygonVertexIndex.properties.a,o=[],i=[],s=[],l=[],c=[],u=[],p=[];if(r.LayerElementColor)var d=v(r.LayerElementColor[0]);if(r.LayerElementMaterial)var h=g(r.LayerElementMaterial[0]);if(r.LayerElementNormal)var b=f(r.LayerElementNormal[0]);if(r.LayerElementUV)for(var y=[],w=0;r.LayerElementUV[w];)y.push(m(r.LayerElementUV[w])),w++;var T={};if(t){var R=t.map;for(var H in R)for(var C=R[H],x=C.indices,I=0;I<x.length;I++){var N=x[I],S=C.weights[I];void 0===T[N]&&(T[N]=[]),T[N].push({id:C.index,weight:S})}}for(var L=0,D=0,A=!1,O=[],F=[],M=[],P=[],k=[],B=[],j=0;j<a.length;j++){var _=a[j],U=!1;_<0&&(_^=-1,a[j]=_,U=!0);var z=[],V=[];if(O.push(3*_,3*_+1,3*_+2),d){var X=E(j,L,_,d);M.push(X[0],X[1],X[2])}if(t){if(void 0!==T[_])for(var W=T[_],I=0,G=W.length;I<G;I++)V.push(W[I].weight),z.push(W[I].id);if(V.length>4){A||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),A=!0);var Z=[0,0,0,0],Y=[0,0,0,0];V.forEach(function(e,t){var r=e,n=z[t];Y.forEach(function(e,t,a){if(r>e){a[t]=r,r=e;var o=Z[t];Z[t]=n,n=o}})}),z=Z,V=Y}for(var w=V.length;w<4;++w)V[w]=0,z[w]=0;for(var w=0;w<4;++w)k.push(V[w]),B.push(z[w])}if(b){var X=E(j,L,_,b);F.push(X[0],X[1],X[2])}if(y)for(var w=0;w<y.length;w++){var X=E(j,L,_,y[w]);void 0===P[w]&&(P[w]=[]),P[w].push(X[0],X[1])}if(D++,U){for(var w=2;w<D;w++)o.push(n[O[0]]),o.push(n[O[1]]),o.push(n[O[2]]),o.push(n[O[3*(w-1)]]),o.push(n[O[3*(w-1)+1]]),o.push(n[O[3*(w-1)+2]]),o.push(n[O[3*w]]),o.push(n[O[3*w+1]]),o.push(n[O[3*w+2]]);if(t)for(var w=2;w<D;w++)u.push(k[0]),u.push(k[1]),u.push(k[2]),u.push(k[3]),u.push(k[4*(w-1)]),u.push(k[4*(w-1)+1]),u.push(k[4*(w-1)+2]),u.push(k[4*(w-1)+3]),u.push(k[4*w]),u.push(k[4*w+1]),u.push(k[4*w+2]),u.push(k[4*w+3]),p.push(B[0]),p.push(B[1]),p.push(B[2]),p.push(B[3]),p.push(B[4*(w-1)]),p.push(B[4*(w-1)+1]),p.push(B[4*(w-1)+2]),p.push(B[4*(w-1)+3]),p.push(B[4*w]),p.push(B[4*w+1]),p.push(B[4*w+2]),p.push(B[4*w+3]);if(b)for(var w=2;w<D;w++)i.push(F[0]),i.push(F[1]),i.push(F[2]),i.push(F[3*(w-1)]),i.push(F[3*(w-1)+1]),i.push(F[3*(w-1)+2]),i.push(F[3*w]),i.push(F[3*w+1]),i.push(F[3*w+2]);if(y)for(var I=0;I<y.length;I++){void 0===l[I]&&(l[I]=[]);for(var w=2;w<D;w++)l[I].push(P[I][0]),l[I].push(P[I][1]),l[I].push(P[I][2*(w-1)]),l[I].push(P[I][2*(w-1)+1]),l[I].push(P[I][2*w]),l[I].push(P[I][2*w+1])}if(d)for(var w=2;w<D;w++)s.push(M[0]),s.push(M[1]),s.push(M[2]),s.push(M[3*(w-1)]),s.push(M[3*(w-1)+1]),s.push(M[3*(w-1)+2]),s.push(M[3*w]),s.push(M[3*w+1]),s.push(M[3*w+2]);if(h&&"AllSame"!==h.mappingType)for(var K=E(j,L,_,h)[0],w=2;w<D;w++)c.push(K),c.push(K),c.push(K);L++,U=!1,D=0,O=[],F=[],M=[],P=[],k=[],B=[]}}var Q=new THREE.BufferGeometry;if(Q.name=e.name,Q.addAttribute("position",new THREE.Float32BufferAttribute(o,3)),s.length>0&&Q.addAttribute("color",new THREE.Float32BufferAttribute(s,3)),t&&(Q.addAttribute("skinIndex",new THREE.Float32BufferAttribute(p,4)),Q.addAttribute("skinWeight",new THREE.Float32BufferAttribute(u,4)),Q.FBX_Deformer=t),i.length>0&&Q.addAttribute("normal",new THREE.Float32BufferAttribute(i,3)),l.length>0)for(var w=0;w<l.length;w++){var q="uv"+(w+1).toString();0==w&&(q="uv"),Q.addAttribute(q,new THREE.Float32BufferAttribute(l[w],2))}if(h&&"AllSame"!==h.mappingType){for(var $=c[0],J=0,w=0;w<c.length;++w)c[w]!==$&&(Q.addGroup(J,w-J,$),$=c[w],J=w);if(Q.groups.length>0){var ee=Q.groups[Q.groups.length-1],te=ee.start+ee.count;te!==c.length&&Q.addGroup(te,c.length-te,$)}0===Q.groups.length&&Q.addGroup(0,c.length,c[0])}return Q}function f(e){var t=e.properties.MappingInformationType,r=e.properties.ReferenceInformationType,n=e.subNodes.Normals.properties.a,a=[];return"IndexToDirect"===r&&("NormalIndex"in e.subNodes?a=e.subNodes.NormalIndex.properties.a:"NormalsIndex"in e.subNodes&&(a=e.subNodes.NormalsIndex.properties.a)),{dataSize:3,buffer:n,indices:a,mappingType:t,referenceType:r}}function m(e){var t=e.properties.MappingInformationType,r=e.properties.ReferenceInformationType,n=e.subNodes.UV.properties.a,a=[];return"IndexToDirect"===r&&(a=e.subNodes.UVIndex.properties.a),{dataSize:2,buffer:n,indices:a,mappingType:t,referenceType:r}}function v(e){var t=e.properties.MappingInformationType,r=e.properties.ReferenceInformationType,n=e.subNodes.Colors.properties.a,a=[];return"IndexToDirect"===r&&(a=e.subNodes.ColorIndex.properties.a),{dataSize:4,buffer:n,indices:a,mappingType:t,referenceType:r}}function g(e){var t=e.properties.MappingInformationType,r=e.properties.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=e.subNodes.Materials.properties.a,a=[],o=0,i=n.length;o<i;++o)a.push(o);return{dataSize:1,buffer:n,indices:a,mappingType:t,referenceType:r}}function E(e,t,r,n){return Y[n.mappingType][n.referenceType](e,t,r,n)}function b(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.properties.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.properties.Order,e.id),new THREE.BufferGeometry;for(var r=t-1,n=e.subNodes.KnotVector.properties.a,a=[],o=e.subNodes.Points.properties.a,i=0,s=o.length;i<s;i+=4)a.push((new THREE.Vector4).fromArray(o,i));var l,c;if("Closed"===e.properties.Form)a.push(a[0]);else if("Periodic"===e.properties.Form){l=r,c=n.length-1-l;for(var i=0;i<r;++i)a.push(a[i])}for(var u=new THREE.NURBSCurve(r,n,a,l,c),p=u.getPoints(7*a.length),d=new Float32Array(3*p.length),i=0,s=p.length;i<s;++i)p[i].toArray(d,3*i);var h=new THREE.BufferGeometry;return h.addAttribute("position",new THREE.BufferAttribute(d,3)),h}function y(e,t,r,n,a){var o=new THREE.Group,i=e.Objects.subNodes.Model,s=[],l=new Map;for(var c in i){for(var u=parseInt(c),p=i[c],d=t.get(u),h=null,f=0;f<d.parents.length;++f)for(var m in r){var v=r[m],g=v.map,E=g[d.parents[f].ID];if(E){var b=h;h=new THREE.Bone,v.bones[E.index]=h,null!==b&&h.add(b)}}if(!h)switch(p.attrType){case"Camera":for(var y,T=0,R=d.children.length;T<R;++T){var H=d.children[T].ID,C=e.Objects.subNodes.NodeAttribute[H];void 0!==C&&void 0!==C.properties&&(y=C.properties)}if(void 0===y)h=new THREE.Object3D;else{var x=0;void 0!==y.CameraProjectionType&&1===y.CameraProjectionType.value&&(x=1);var N=1;void 0!==y.NearPlane&&(N=y.NearPlane.value/1e3);var S=1e3;void 0!==y.FarPlane&&(S=y.FarPlane.value/1e3);var L=window.innerWidth,D=window.innerHeight;void 0!==y.AspectWidth&&void 0!==y.AspectHeight&&(L=y.AspectWidth.value,D=y.AspectHeight.value);var A=L/D,O=45;switch(void 0!==y.FieldOfView&&(O=y.FieldOfView.value),x){case 0:h=new THREE.PerspectiveCamera(O,A,N,S);break;case 1:h=new THREE.OrthographicCamera(-L/2,L/2,D/2,-D/2,N,S);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+x+"."),h=new THREE.Object3D}}break;case"Light":for(var F,T=0,R=d.children.length;T<R;++T){var H=d.children[T].ID,C=e.Objects.subNodes.NodeAttribute[H];void 0!==C&&void 0!==C.properties&&(F=C.properties)}if(void 0===F)h=new THREE.Object3D;else{var x;x=void 0===F.LightType?0:F.LightType.value;var M=16777215;void 0!==F.Color&&(M=z(F.Color.value));var P=void 0===F.Intensity?1:F.Intensity.value/100;void 0!==F.CastLightOnObject&&0===F.CastLightOnObject.value&&(P=0);var k=0;void 0!==F.FarAttenuationEnd&&(k=void 0!==F.EnableFarAttenuation&&0===F.EnableFarAttenuation.value?0:F.FarAttenuationEnd.value/1e3);switch(x){case 0:h=new THREE.PointLight(M,P,k,1);break;case 1:h=new THREE.DirectionalLight(M,P);break;case 2:var B=Math.PI/3;void 0!==F.InnerAngle&&(B=THREE.Math.degToRad(F.InnerAngle.value));var j=0;void 0!==F.OuterAngle&&(j=THREE.Math.degToRad(F.OuterAngle.value),j=Math.max(j,1)),h=new THREE.SpotLight(M,P,k,B,j,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+F.LightType.value+", defaulting to a THREE.PointLight."),h=new THREE.PointLight(M,P)}void 0!==F.CastShadows&&1===F.CastShadows.value&&(h.castShadow=!0)}break;case"Mesh":for(var _=null,U=null,V=[],T=0,R=d.children.length;T<R;++T){var W=d.children[T];n.has(W.ID)&&(_=n.get(W.ID)),a.has(W.ID)&&V.push(a.get(W.ID))}if(V.length>1?U=V:V.length>0?U=V[0]:(U=new THREE.MeshPhongMaterial({color:13421772}),V.push(U)),"color"in _.attributes)for(var G=0,Z=V.length;G<Z;++G)V[G].vertexColors=THREE.VertexColors;if(_.FBX_Deformer){for(var Y=0,K=V.length;Y<K;++Y)V[Y].skinning=!0;h=new THREE.SkinnedMesh(_,U)}else h=new THREE.Mesh(_,U);break;case"NurbsCurve":for(var _=null,T=0,R=d.children.length;T<R;++T){var W=d.children[T];n.has(W.ID)&&(_=n.get(W.ID))}U=new THREE.LineBasicMaterial({color:3342591,linewidth:5}),h=new THREE.Line(_,U);break;default:h=new THREE.Group}h.name=THREE.PropertyBinding.sanitizeNodeName(p.attrName),h.FBX_ID=u,s.push(h),l.set(u,h)}for(var Q=0,q=s.length;Q<q;++Q){var h=s[Q],p=i[h.FBX_ID];if("Lcl_Translation"in p.properties&&h.position.fromArray(p.properties.Lcl_Translation.value),"Lcl_Rotation"in p.properties){var $=p.properties.Lcl_Rotation.value.map(THREE.Math.degToRad);$.push("ZYX"),h.rotation.fromArray($)}if("Lcl_Scaling"in p.properties&&h.scale.fromArray(p.properties.Lcl_Scaling.value),"PreRotation"in p.properties){var J=p.properties.PreRotation.value.map(THREE.Math.degToRad);J[3]="ZYX";var ee=(new THREE.Euler).fromArray(J);ee=(new THREE.Quaternion).setFromEuler(ee);var te=(new THREE.Quaternion).setFromEuler(h.rotation);ee.multiply(te),h.rotation.setFromQuaternion(ee,"ZYX")}if("GeometricTranslation"in p.properties){var J=p.properties.GeometricTranslation.value;h.traverse(function(e){e.geometry&&e.geometry.translate(J[0],J[1],J[2])})}if("LookAtProperty"in p.properties)for(var d=t.get(h.FBX_ID),T=0,R=d.children.length;T<R;++T){var W=d.children[T];if("LookAtProperty"===W.relationship){var re=e.Objects.subNodes.Model[W.ID];if("Lcl_Translation"in re.properties){var ne=re.properties.Lcl_Translation.value;void 0!==h.target?(h.target.position.set(ne[0],ne[1],ne[2]),o.add(h.target)):h.lookAt(new THREE.Vector3(ne[0],ne[1],ne[2]))}}}for(var d=t.get(h.FBX_ID),ae=0;ae<d.parents.length;ae++){var oe=X(s,function(e){return e.FBX_ID===d.parents[ae].ID});if(oe>-1){s[oe].add(h);break}}null===h.parent&&o.add(h)}o.updateMatrixWorld(!0);var ie=new Map;if("Pose"in e.Objects.subNodes){var se=e.Objects.subNodes.Pose;for(var c in se)if("BindPose"===se[c].attrType){se=se[c];break}for(var le=se.subNodes.PoseNode,ce=0,ue=le.length;ce<ue;++ce){var p=le[ce],pe=(new THREE.Matrix4).fromArray(p.subNodes.Matrix.properties.a);ie.set(parseInt(p.properties.Node),pe)}}for(var m in r){var v=r[m],g=v.map;for(var de in g){var E=g[de],he=E.index,fe=v.bones[he];if(!ie.has(fe.FBX_ID))break;var me=ie.get(fe.FBX_ID);fe.matrixWorld.copy(me)}v.skeleton=new THREE.Skeleton(v.bones);for(var d=t.get(v.FBX_ID),ve=d.parents,ge=0,Ee=ve.length;ge<Ee;++ge){var be=ve[ge];if(n.has(be.ID))for(var ye=be.ID,we=t.get(ye),f=0;f<we.parents.length;++f)if(l.has(we.parents[f].ID)){var h=l.get(we.parents[f].ID);h.bind(v.skeleton,h.matrixWorld);break}}}if(o.updateMatrixWorld(!0),o.skeleton={bones:s},I(o,w(e,t,o)),"GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings.properties){var Te=e.GlobalSettings.properties.AmbientColor.value,Re=Te[0],He=Te[1],Ce=Te[2];if(0!==Re||0!==He||0!==Ce){var M=new THREE.Color(Re,He,Ce);o.add(new THREE.AmbientLight(M,1))}}return o}function w(e,t,r){var n=e.Objects.subNodes.AnimationCurveNode,a=e.Objects.subNodes.AnimationCurve,o=e.Objects.subNodes.AnimationLayer,i=e.Objects.subNodes.AnimationStack,s=30;if("GlobalSettings"in e&&"TimeMode"in e.GlobalSettings.properties){var l=[30,120,100,60,50,48,30,30,29.97,29.97,25,24,1,23.976,30,96,72,59.94],c=e.GlobalSettings.properties.TimeMode.value;14===c?"CustomFrameRate"in e.GlobalSettings.properties&&(s=e.GlobalSettings.properties.CustomFrameRate.value,s=-1===s?30:s):c<=17&&(s=l[c])}var u={curves:new Map,layers:{},stacks:{},length:0,fps:s,frames:0},p=[];for(var d in n)if(d.match(/\d+/)){var h=T(e,n[d],t,r);p.push(h)}for(var f=new Map,m=0;m<p.length;++m)null!==p[m]&&f.set(p[m].id,p[m]);var v=[];for(d in a)if(d.match(/\d+/)){var g=R(a[d]);if(!t.has(g.id))continue;v.push(g);var E=t.get(g.id).parents[0],b=E.ID,y=E.relationship,w="";if(y.match(/X/))w="x";else if(y.match(/Y/))w="y";else{if(!y.match(/Z/))continue;w="z"}f.get(b).curves[w]=g}f.forEach(function(e){var t=e.containerBoneID;if(u.curves.has(t)||u.curves.set(t,{T:null,R:null,S:null}),u.curves.get(t)[e.attr]=e,"R"===e.attr){var r=e.curves;if(null===r.x&&(r.x={version:null,times:[0],values:[0]}),null===r.y&&(r.y={version:null,times:[0],values:[0]}),null===r.z&&(r.z={version:null,times:[0],values:[0]}),r.x.values=r.x.values.map(THREE.Math.degToRad),r.y.values=r.y.values.map(THREE.Math.degToRad),r.z.values=r.z.values.map(THREE.Math.degToRad),null!==e.preRotations){var n=(new THREE.Euler).setFromVector3(e.preRotations,"ZYX");n=(new THREE.Quaternion).setFromEuler(n);for(var a=new THREE.Euler,o=new THREE.Quaternion,i=0;i<r.x.times.length;++i)a.set(r.x.values[i],r.y.values[i],r.z.values[i],"ZYX"),o.setFromEuler(a).premultiply(n),a.setFromQuaternion(o,"ZYX"),r.x.values[i]=a.x,r.y.values[i]=a.y,r.z.values[i]=a.z}}});for(var d in o){for(var C=[],x=t.get(parseInt(d)).children,I=0;I<x.length;I++)if(f.has(x[I].ID)){var N=f.get(x[I].ID),S=N.containerBoneID;void 0===C[S]&&(C[S]={T:null,R:null,S:null}),C[S][N.attr]=N}u.layers[d]=C}for(var d in i){for(var L=[],x=t.get(parseInt(d)).children,D={max:0,min:Number.MAX_VALUE},I=0;I<x.length;++I){var A=u.layers[x[I].ID];if(void 0!==A){L.push(A);for(var O=0,F=A.length;O<F;++O){var C=A[O];C&&H(C,D)}}}D.max>D.min&&(u.stacks[d]={name:i[d].attrName,layers:L,length:D.max-D.min,frames:(D.max-D.min)*u.fps})}return u}function T(e,t,r,n){var a=e.Objects.subNodes.Model,o={id:t.id,attr:t.attrName,internalID:t.id,attrX:!1,attrY:!1,attrZ:!1,containerBoneID:-1,containerID:-1,curves:{x:null,y:null,z:null},preRotations:null};if(!o.attr.match(/S|R|T/))return null;for(var i in t.properties)i.match(/X/)&&(o.attrX=!0),i.match(/Y/)&&(o.attrY=!0),i.match(/Z/)&&(o.attrZ=!0);for(var s=r.get(o.id),l=s.parents,c=l.length-1;c>=0;--c){var u=X(n.skeleton.bones,function(e){return e.FBX_ID===l[c].ID});if(u>-1){o.containerBoneID=u,o.containerID=l[c].ID;var p=a[o.containerID.toString()];"PreRotation"in p.properties&&(o.preRotations=U(p.properties.PreRotation).multiplyScalar(Math.PI/180));break}}return o}function R(e){return{version:null,id:e.id,internalID:e.id,times:e.subNodes.KeyTime.properties.a.map(j),values:e.subNodes.KeyValueFloat.properties.a,attrFlag:e.subNodes.KeyAttrFlags.properties.a,attrData:e.subNodes.KeyAttrDataFloat.properties.a}}function H(e,t){e.R&&C(e.R.curves,t),e.S&&C(e.S.curves,t),e.T&&C(e.T.curves,t)}function C(e,t){e.x&&x(e.x,t),e.y&&x(e.y,t),e.z&&x(e.z,t)}function x(e,t){t.max=e.times[e.times.length-1]>t.max?e.times[e.times.length-1]:t.max,t.min=e.times[0]<t.min?e.times[0]:t.min}function I(e,t){void 0===e.animations&&(e.animations=[]);var r=t.stacks;for(var n in r){for(var a=r[n],o={name:a.name,fps:t.fps,length:a.length,hierarchy:[]},i=e.skeleton.bones,s=0,l=i.length;s<l;++s){var c=i[s],u=c.name.replace(/.*:/,""),p=X(i,function(e){return c.parent===e});o.hierarchy.push({parent:p,name:u,keys:[]})}for(var d=0;d<=a.frames;d++)for(var s=0,l=i.length;s<l;++s)for(var c=i[s],h=s,f=a.layers[0][h],m=0,v=o.hierarchy.length;m<v;++m){var g=o.hierarchy[m];g.name===c.name&&g.keys.push(N(t,f,c,d))}e.animations.push(THREE.AnimationClip.parseAnimation(o,i))}}function N(e,t,r,n){var a={time:n/e.fps,pos:r.position.toArray(),rot:r.quaternion.toArray(),scl:r.scale.toArray()};if(void 0===t)return a;K.setFromQuaternion(r.quaternion,"ZYX",!1);try{S(t,"T")&&L(t.T,n)&&(t.T.curves.x.values[n]&&(a.pos[0]=t.T.curves.x.values[n]),t.T.curves.y.values[n]&&(a.pos[1]=t.T.curves.y.values[n]),t.T.curves.z.values[n]&&(a.pos[2]=t.T.curves.z.values[n])),S(t,"R")&&L(t.R,n)&&(t.R.curves.x.values[n]&&(K.x=t.R.curves.x.values[n]),t.R.curves.y.values[n]&&(K.y=t.R.curves.y.values[n]),t.R.curves.z.values[n]&&(K.z=t.R.curves.z.values[n]),Q.setFromEuler(K),a.rot=Q.toArray()),S(t,"S")&&L(t.S,n)&&(t.T.curves.x.values[n]&&(a.scl[0]=t.S.curves.x.values[n]),t.T.curves.y.values[n]&&(a.scl[1]=t.S.curves.y.values[n]),t.T.curves.z.values[n]&&(a.scl[2]=t.S.curves.z.values[n]))}catch(e){}return a}function S(e,t){if(void 0===e)return!1;var r=e[t];return!!r&&q.every(function(e){return null!==r.curves[e]})}function L(e,t){return q.every(function(r){return D(e.curves[r],t)})}function D(e,t){return void 0!==e.values[t]}function A(){}function O(){}function F(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function M(){}function P(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===V(e,0,t.length)}function k(e){for(var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0,n=0;n<t.length;++n){if(function(t){var n=e[t-1];return e=e.slice(r+t),r++,n}(1)===t[n])return!1}return!0}function B(e){var t=/FBXVersion: (\d+)/,r=e.match(t);if(r){return parseInt(r[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function j(e){return e/46186158e3}function _(e){for(var t=e.split(","),r=0,n=t.length;r<n;r++)t[r]=parseFloat(t[r]);return t}function U(e){return(new THREE.Vector3).fromArray(e.value)}function z(e){return(new THREE.Color).fromArray(e.value)}function V(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.byteLength);var n=new Uint8Array(e,t,r);if(void 0!==window.TextDecoder)return(new TextDecoder).decode(n);for(var a="",o=0,i=n.length;o<i;o++)a+=String.fromCharCode(n[o]);return a}function X(e,t){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return r;return-1}function W(e,t){for(var r=0,n=e.length,a=t.length;r<a;r++,n++)e[n]=t[r]}function G(e,t,r,n){for(var a=r,o=0;a<n;a++,o++)e[o]=t[a];return e}THREE.FBXLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.FBXLoader.prototype,{load:function(e,t,r,n){var a=this,o=THREE.Loader.prototype.extractUrlBase(e),i=new THREE.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.load(e,function(r){try{var i=a.parse(r,o);t(i)}catch(t){window.setTimeout(function(){n&&n(t),a.manager.itemError(e)},0)}},r,n)},parse:function(r,a){var i;if(P(r))i=(new O).parse(r);else{var s=V(r);if(!k(s))throw new Error("THREE.FBXLoader: Unknown format.");if(B(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+B(s));i=(new A).parse(s)}var c=e(i),p=t(i),d=n(i,new THREE.TextureLoader(this.manager).setPath(a),p,c),h=o(i,d,c),f=l(i,c);return y(i,c,f,u(i,c,f),h)}});var Z=[],Y={ByPolygonVertex:{Direct:function(e,t,r,n){var a=e*n.dataSize,o=e*n.dataSize+n.dataSize;return G(Z,n.buffer,a,o)},IndexToDirect:function(e,t,r,n){var a=n.indices[e],o=a*n.dataSize,i=a*n.dataSize+n.dataSize;return G(Z,n.buffer,o,i)}},ByPolygon:{Direct:function(e,t,r,n){var a=t*n.dataSize,o=t*n.dataSize+n.dataSize;return G(Z,n.buffer,a,o)},IndexToDirect:function(e,t,r,n){var a=n.indices[t],o=a*n.dataSize,i=a*n.dataSize+n.dataSize;return G(Z,n.buffer,o,i)}},ByVertice:{Direct:function(e,t,r,n){var a=r*n.dataSize,o=r*n.dataSize+n.dataSize;return G(Z,n.buffer,a,o)}},AllSame:{IndexToDirect:function(e,t,r,n){var a=n.indices[0]*n.dataSize,o=n.indices[0]*n.dataSize+n.dataSize;return G(Z,n.buffer,a,o)}}},K=new THREE.Euler,Q=new THREE.Quaternion,q=["x","y","z"];Object.assign(A.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new M,this.nodeStack=[],this.currentProp=[],this.currentPropName="";for(var t=e.split("\n"),r=0,n=t.length;r<n;r++){var a=t[r];if(!a.match(/^[\s\t]*;/)&&!a.match(/^[\s\t]*$/)){var o=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){",""),i=a.match(o);if(i){for(var s=i[1].trim().replace(/^"/,"").replace(/"$/,""),l=i[2].split(","),c=0,a=l.length;c<a;c++)l[c]=l[c].trim().replace(/^"/,"").replace(/"$/,"");this.parseNodeBegin(a,s,l||null)}else{var u=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),i=a.match(u);if(i){var p=i[1].replace(/^"/,"").replace(/"$/,"").trim(),d=i[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===p&&","===d&&(d=t[++r].replace(/"/g,"").replace(/,$/,"").trim()),this.parseNodeProperty(a,p,d)}else{var h=new RegExp("^\\t{"+(this.currentIndent-1)+"}}");a.match(h)?this.nodeEnd():a.match(/^[^\s\t}]/)&&this.parseNodePropertyContinued(a)}}}}return this.allNodes},parseNodeBegin:function(e,t,r){var n={name:t,properties:{},subNodes:{}},a=this.parseNodeAttr(r),o=this.getCurrentNode();if(0===this.currentIndent)this.allNodes.add(t,n);else if(t in o.subNodes){var i=o.subNodes[t];this.isFlattenNode(o.subNodes[t])&&(""===a.id?(o.subNodes[t]=[],o.subNodes[t].push(i)):(o.subNodes[t]={},o.subNodes[t][i.id]=i)),""===a.id?o.subNodes[t].push(n):o.subNodes[t][a.id]=n}else"number"==typeof a.id||a.id.match(/^\d+$/)?(o.subNodes[t]={},o.subNodes[t][a.id]=n):o.subNodes[t]=n;r&&(n.id=a.id,n.attrName=a.name,n.attrType=a.type),this.pushStack(n)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}},parseNodeProperty:function(e,t,r){var n=this.getCurrentNode(),a=n.name;if(void 0!==a){if(a.match(/Properties(\d)+/))return void this.parseNodeSpecialProperty(e,t,r)}if("C"===t){var o=r.split(",").slice(1),i=parseInt(o[0]),s=parseInt(o[1]),l=r.split(",").slice(3);l=l.map(function(e){return e.trim().replace(/^"/,"")}),t="connections",r=[i,s],W(r,l),void 0===n.properties[t]&&(n.properties[t]=[])}if("Node"===t){var c=parseInt(r);n.properties.id=c,n.id=c}t in n.properties?Array.isArray(n.properties[t])?n.properties[t].push(r):n.properties[t]+=r:Array.isArray(n.properties[t])?n.properties[t].push(r):n.properties[t]=r,this.setCurrentProp(n.properties,t),"a"===t&&","!==r.slice(-1)&&(n.properties.a=_(r))},parseNodePropertyContinued:function(e){if(this.currentProp[this.currentPropName]+=e,","!==e.slice(-1)){var t=this.getCurrentNode();t.properties.a=_(t.properties.a)}},parseNodeSpecialProperty:function(e,t,r){for(var n=r.split('",'),a=0,o=n.length;a<o;a++)n[a]=n[a].trim().replace(/^\"/,"").replace(/\s/,"_");var i=n[0],s=n[1],l=n[2],c=n[3],u=n[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":u=parseInt(u);break;case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=_(u)}this.getPrevNode().properties[i]={type:s,type2:l,flag:c,value:u},this.setCurrentProp(this.getPrevNode().properties,i)},nodeEnd:function(){this.popStack()},isFlattenNode:function(e){return"subNodes"in e&&"properties"in e}}),Object.assign(O.prototype,{parse:function(e){var t=new F(e);t.skip(23);var r=t.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+r);for(var n=new M;!this.endOfContent(t);){var a=this.parseNode(t,r);null!==a&&n.add(a.name,a)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32(),a=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),o=e.getString(a);if(0===r)return null;for(var i=[],s=0;s<n;s++)i.push(this.parseProperty(e));var l=i.length>0?i[0]:"",c=i.length>1?i[1]:"",u=i.length>2?i[2]:"",p={},d={},h=!1;for(1===n&&e.getOffset()===r&&(h=!0);r>e.getOffset();){var f=this.parseNode(e,t);if(null!==f)if(!0!==f.singleProperty)if("Connections"!==o||"C"!==f.name)if(f.name.match(/^Properties\d+$/))for(var m=Object.keys(f.properties),s=0,v=m.length;s<v;s++){var g=m[s];d[g]=f.properties[g]}else if(o.match(/^Properties\d+$/)&&"P"===f.name){var E,b=f.propertyList[0],y=f.propertyList[1],w=f.propertyList[2],T=f.propertyList[3];0===b.indexOf("Lcl ")&&(b=b.replace("Lcl ","Lcl_")),0===y.indexOf("Lcl ")&&(y=y.replace("Lcl ","Lcl_")),E="ColorRGB"===y||"Vector"===y||"Vector3D"===y||0===y.indexOf("Lcl_")?[f.propertyList[4],f.propertyList[5],f.propertyList[6]]:f.propertyList[4],d[b]={type:y,type2:w,flag:T,value:E}}else void 0===p[f.name]?"number"==typeof f.id?(p[f.name]={},p[f.name][f.id]=f):p[f.name]=f:""===f.id?(Array.isArray(p[f.name])||(p[f.name]=[p[f.name]]),p[f.name].push(f)):void 0===p[f.name][f.id]?p[f.name][f.id]=f:(Array.isArray(p[f.name][f.id])||(p[f.name][f.id]=[p[f.name][f.id]]),p[f.name][f.id].push(f));else{for(var R=[],s=1,v=f.propertyList.length;s<v;s++)R[s-1]=f.propertyList[s];void 0===d.connections&&(d.connections=[]),d.connections.push(R)}else{var H=f.propertyList[0];Array.isArray(H)?(p[f.name]=f,f.properties.a=H):d[f.name]=H}}return{singleProperty:h,id:l,attrName:c,attrType:u,name:o,properties:d,propertyList:i,subNodes:p}},parseProperty:function(e){var t=e.getChar();switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":var r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=e.getUint32(),a=e.getUint32(),o=e.getUint32();if(0===a)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}if(void 0===window.Zlib)throw new Error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var i=new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))),s=new F(i.decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(n);case"d":return s.getFloat64Array(n);case"f":return s.getFloat32Array(n);case"i":return s.getInt32Array(n);case"l":return s.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}),Object.assign(F.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getInt8:function(){var e=this.dv.getInt8(this.offset);return this.offset+=1,e},getInt8Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt8());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint8Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getUint8());return t},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt16Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt16());return t},getUint16:function(){var e=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,e},getUint16Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getUint16());return t},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getUint32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getUint32());return t},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getUint64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getUint64());return t},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getChar:function(){return String.fromCharCode(this.getUint8())},getString:function(e){for(var t="";e>0;){var r=this.getUint8();if(e--,0===r)break;t+=String.fromCharCode(r)}return t=decodeURIComponent(escape(t)),this.skip(e),t}}),Object.assign(M.prototype,{add:function(e,t){this[e]=t}})}();var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,r,n;e=e||{},t=void 0!==e.parent?e.parent:document.body,r=void 0!==e.id?e.id:"oldie",n=Detector.getWebGLErrorMessage(),n.id=r,t.appendChild(n)}};"object"===("undefined"==typeof module?"undefined":_typeof(module))&&(module.exports=Detector);var container,stats,controls,textureCube,camera,scene,renderer,light,clock=new THREE.Clock,mixers=[],action,timer=null,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2;THREE.Cache.enabled=!0;var timgs=["ALBEDO-02.jpg","car_body01.png","car_chrome.png","car_chrome02.png","car_int01.png","Car_Int02.png","car_int03.png","Car_Int06.png","car_light.png","car_plastic01.png","car_plastic02.png","Car_plate.jpg","car_plate.png","car_seat.png","car_wheel.png","gez.jpg","SenyaR9_VR_BG_V0401.jpg","shadow.jpg","shadowtouming.png","Wheel_FL01.png"],hjimgs=["negx.jpg","negy.jpg","negz.jpg","posx.jpg","posy.jpg","posz.jpg"];timgs.forEach(function(e){var t=new Image;t.src="textures/"+e,t.style.display="none",t.onload=function(r){THREE.Cache.add("./textures\\"+e,t)}}),hjimgs.forEach(function(e){var t=new Image;t.src="img/hj/"+e,t.style.display="none",t.onload=function(r){THREE.Cache.add("img/hj/"+e,t)}}),init();